# Ð ÑƒÐºÐ¾Ð²Ð¾Ð´ÑÑ‚Ð²Ð¾ Ð¿Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²

## ðŸš€ Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### 1. Ð—Ð°Ð¿ÑƒÑÐº Ð±Ð¾Ñ‚Ð°
```bash
# Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾
python3 bot/main.py

# Ð’ Docker
docker-compose up -d
```

### 2. ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ (PDF, JPG, DOCX, XLSX, ZIP) Ð² Telegram-Ð±Ð¾Ñ‚Ð°. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:
- Ð˜Ð·Ð²Ð»ÐµÑ‡Ñ‘Ñ‚ Ñ‚ÐµÐºÑÑ‚
- ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚ Ñ‚Ð¸Ð¿ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°
- Ð˜Ð·Ð²Ð»ÐµÑ‡Ñ‘Ñ‚ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¿Ð¾Ð»Ñ
- Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ Ð² ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½ÑƒÑŽ Ð±Ð°Ð·Ñƒ
- Ð¡Ð¾Ð·Ð´Ð°ÑÑ‚/Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ Ð±Ð¸Ð·Ð½ÐµÑ-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸

### 3. ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð¾Ð²
Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð² Telegram-Ð±Ð¾Ñ‚Ðµ:

```
/report                    # ÐžÐ±Ñ‰Ð¸Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ Ð²ÑÐµÐ¼ ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚Ð°Ð¼
/report ÐžÐžÐž ÐšÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚     # ÐžÑ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼Ñƒ ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚Ñƒ
/unclosed                 # ÐÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð±Ð¸Ð·Ð½ÐµÑ-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸
/monthly 2024 12          # ÐœÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚
/chain Ð”-2024-001         # Ð”ÐµÑ‚Ð°Ð»Ð¸ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸
```

## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ

Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð¿Ð¾ ÑÑ…ÐµÐ¼Ðµ:
```
data/documents/
â”œâ”€â”€ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ñ‹/
â”‚   â””â”€â”€ ÐžÐžÐž ÐšÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚/
â”‚       â””â”€â”€ 20241201_143022_Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€.pdf
â”œâ”€â”€ ÑÑ‡ÐµÑ‚Ð°/
â”œâ”€â”€ Ð°ÐºÑ‚Ñ‹/
â”œâ”€â”€ Ð½Ð°ÐºÐ»Ð°Ð´Ð½Ñ‹Ðµ/
â”œâ”€â”€ ÑÑ‡ÐµÑ‚-Ñ„Ð°ÐºÑ‚ÑƒÑ€Ñ‹/
â”œâ”€â”€ ÑƒÐ¿Ð´/
â”œâ”€â”€ Ð²Ñ‹Ð¿Ð¸ÑÐºÐ¸/
â””â”€â”€ Ð¸Ð½Ñ‹Ðµ/
```

## ðŸ—„ï¸ Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…

SQLite Ð±Ð°Ð·Ð°: `data/documents/documents.db`

### Ð¢Ð°Ð±Ð»Ð¸Ñ†Ñ‹:
- **documents** â€” Ð²ÑÐµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹
- **counterparties** â€” ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚Ñ‹ Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¾Ð¹
- **business_chains** â€” Ð±Ð¸Ð·Ð½ÐµÑ-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸
- **chain_links** â€” ÑÐ²ÑÐ·Ð¸ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð² Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ°Ñ…

### ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð´Ð°Ð½Ð½Ñ‹Ñ…:
```bash
sqlite3 data/documents/documents.db
.tables                    # Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð°Ð±Ð»Ð¸Ñ†
SELECT * FROM documents;   # Ð’ÑÐµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹
SELECT * FROM business_chains;  # Ð‘Ð¸Ð·Ð½ÐµÑ-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸
```

## ðŸ“Š Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð¾Ð²

### ÐšÐ¾Ð¼Ð°Ð½Ð´Ð½Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ°:
```bash
# ÐžÑ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚Ð°Ð¼
python3 export_reports.py --type counterparties --format excel

# ÐÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸
python3 export_reports.py --type unclosed --format csv

# ÐœÐµÑÑÑ‡Ð½Ñ‹Ð¹ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚
python3 export_reports.py --type monthly --year 2024 --month 12

# Ð¡ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸ÐµÐ¹ Ð¿Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚Ñƒ
python3 export_reports.py --type counterparties --counterparty "ÐžÐžÐž ÐšÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚"
```

### ÐŸÑ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð½Ð¾:
```python
from analytics import analytics

# ÐžÑ‚Ñ‡Ñ‘Ñ‚ Ð¿Ð¾ ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚Ð°Ð¼
report = analytics.generate_counterparty_report()
analytics.export_to_excel(report, "Ð¾Ñ‚Ñ‡ÐµÑ‚.xlsx")

# ÐÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸
unclosed = analytics.generate_unclosed_chains_report()
analytics.export_to_csv(unclosed, "Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ")
```

## ðŸ”— Ð‘Ð¸Ð·Ð½ÐµÑ-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ Ð¸ Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ Ð±Ð¸Ð·Ð½ÐµÑ-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸:

**Ð”Ð¾Ð³Ð¾Ð²Ð¾Ñ€** â†’ **Ð¡Ñ‡ÐµÑ‚Ð°** â†’ **Ð—Ð°ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹** (Ð°ÐºÑ‚Ñ‹, Ð½Ð°ÐºÐ»Ð°Ð´Ð½Ñ‹Ðµ, Ð£ÐŸÐ”)

### Ð›Ð¾Ð³Ð¸ÐºÐ°:
1. **Ð”Ð¾Ð³Ð¾Ð²Ð¾Ñ€** ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ Ð½Ð¾Ð²ÑƒÑŽ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ
2. **Ð¡Ñ‡ÐµÑ‚Ð°** Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ Ðº Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐµ Ð¿Ð¾ Ð½Ð¾Ð¼ÐµÑ€Ñƒ Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€Ð°
3. **Ð—Ð°ÐºÑ€Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹** ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ°ÑŽÑ‚ Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚ÑƒÑŽ ÑÑƒÐ¼Ð¼Ñƒ
4. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ñ‚ÑÐ»ÐµÐ¶Ð¸Ð²Ð°ÐµÑ‚ Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸ Ð¸ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚ Ñ†ÐµÐ¿Ð¾Ñ‡ÐµÐº

### Ð¡Ñ‚Ð°Ñ‚ÑƒÑÑ‹ Ñ†ÐµÐ¿Ð¾Ñ‡ÐµÐº:
- **active** â€” Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°Ñ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ°
- **closed** â€” Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ð°Ñ
- **overdue** â€” Ð¿Ñ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð½Ð°Ñ

## ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ñ‹ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹:
```bash
python3 test_storage.py
```

Ð¢ÐµÑÑ‚ ÑÐ¾Ð·Ð´Ð°ÑÑ‚:
- Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ (Ð´Ð¾Ð³Ð¾Ð²Ð¾Ñ€, ÑÑ‡Ñ‘Ñ‚, Ð°ÐºÑ‚)
- Ð‘Ð¸Ð·Ð½ÐµÑ-Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÑƒ
- ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹ Ð¸ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÑƒ

## âš™ï¸ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°

### ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ:
```bash
TELEGRAM_TOKEN=your_bot_token
OLLAMA_HOST=http://ollama:11434
OLLAMA_MODEL=mistral
OUR_COMPANY="ÐžÐžÐž Ð’Ð°ÑˆÐ° ÐšÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ñ"
```

### ÐŸÑƒÑ‚Ð¸ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼:
- Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…: `data/documents/documents.db`
- Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹: `data/documents/{Ñ‚Ð¸Ð¿}/{ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚}/`
- ÐžÑ‚Ñ‡Ñ‘Ñ‚Ñ‹: `reports/`

## ðŸ”§ Ð£ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð½ÐµÐ¿Ð¾Ð»Ð°Ð´Ð¾Ðº

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð±Ð°Ð·Ð¾Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ…:
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
sqlite3 data/documents/documents.db ".schema"

# Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ
cp data/documents/documents.db backup_$(date +%Y%m%d).db
```

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð¾Ñ‚Ñ‡Ñ‘Ñ‚Ð°Ð¼Ð¸:
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
pip3 install pandas openpyxl

# Ð¢ÐµÑÑ‚ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸
python3 -c "from analytics import analytics; print('OK')"
```

### ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…:
```bash
rm -rf data/documents/*
rm -rf reports/*
```

## ðŸ“ˆ ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

### ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸:
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð² Ð±Ð°Ð·Ðµ
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ†ÐµÐ¿Ð¾Ñ‡ÐµÐº
- ÐžÐ±Ñ‰Ð°Ñ Ð½ÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ð°Ñ ÑÑƒÐ¼Ð¼Ð°
- Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚ ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ñ†ÐµÐ¿Ð¾Ñ‡ÐµÐº (>90 Ð´Ð½ÐµÐ¹)

### ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°:
```bash
# ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
sqlite3 data/documents/documents.db "SELECT COUNT(*) FROM documents;"

# ÐÐµÐ·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ñ†ÐµÐ¿Ð¾Ñ‡ÐºÐ¸
sqlite3 data/documents/documents.db "SELECT COUNT(*) FROM business_chains WHERE total_amount > closed_amount;"

# Ð¢Ð¾Ð¿ ÐºÐ¾Ð½Ñ‚Ñ€Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð²
sqlite3 data/documents/documents.db "SELECT counterparty, SUM(amount) as total FROM documents GROUP BY counterparty ORDER BY total DESC LIMIT 5;"
``` 